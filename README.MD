# CBIR IMAGE SEARCH ‚Äì Content-Based Image Retrieval

> Reidentificaci√≥n de celebridades mediante visi√≥n artificial.

Este proyecto implementa un sistema de Recuperaci√≥n de Im√°genes Basado en Contenido (CBIR) dise√±ado para la reidentificaci√≥n de personas. Utiliza un pipeline modular en Python que integra **FAISS** para la indexaci√≥n vectorial de alta velocidad y permite comparar el rendimiento de 5 extractores de caracter√≠sticas que representan la evoluci√≥n del estado del arte en visi√≥n artificial.

El sistema incluye una interfaz interactiva basada en **Streamlit** y un m√≥dulo de evaluaci√≥n automatizada.

## üöÄ Gu√≠a de Inicio R√°pido
### 1. Preparaci√≥n de los Datos
1.  **Descarga el *dataset* de galer√≠a (images):** [Enlace a Google Drive](https://drive.google.com/drive/folders/1gIFuspPFP5dRvDbXX0FnwGBM5fhbfAz3?usp=sharing)
2.  **Descarga el *dataset* de consulta (test):** [Enlace a Google Drive](https://drive.google.com/drive/folders/1jYbeSWFMlA3aM-rnECpdqRfAL51p2NjO?usp=sharing)
3.  **Estructura de carpetas:** Descomprime los archivos y aseg√∫rate de que tu proyecto tenga esta estructura exacta:

    ```text
    /proyecto
    ‚îú‚îÄ‚îÄ /images              # Im√°genes de Galer√≠a (Base de conocimiento)
    ‚îÇ   ‚îú‚îÄ‚îÄ /Angelina Jolie
    ‚îÇ   ‚îú‚îÄ‚îÄ /Leonardo DiCaprio
    ‚îÇ   ‚îî‚îÄ‚îÄ ...
    ‚îÇ
    ‚îî‚îÄ‚îÄ /test                # Im√°genes de Consulta (Para pruebas)
        ‚îú‚îÄ‚îÄ /Angelina Jolie
        ‚îî‚îÄ‚îÄ ...
    ```

### 2. Instalaci√≥n de Dependencias
1. **Crear el entorno**

En la terminal Windows, dentro de la carpeta del proyecto:

```bash
python -m venv venv
venv\Scripts\activate
```

En la terminal Linux o Mac, dentro de la carpeta del proyecto:
```bash
python3 -m venv venv
source venv/bin/activate
```

2. **Instalar requisitos**

```bash
pip install -r requirements.txt
```

### 3. Generaci√≥n de √çndices FAISS

**Nota: la carpeta ```/cbir_database``` que viene dada en este repositorio corresponde con los √≠ndices FAISS de nuestro conjunto de datos de galer√≠a. Si es el conjunto con el que quieres hacer la b√∫squeda, puedes saltarte este paso.**

Antes de realizar b√∫squedas, es necesario procesar las im√°genes de la galer√≠a y generar los √≠ndices vectoriales .faiss.

```bash
python cbir.py
```

Este comando:
- Recorre la carpeta ```/images```
- Extrae *embeddings* usando los 5 extractores (Histograma, SIFT, ResNet50, VGG-Face, DINOv2).
- Normaliza los vectores
- Genera los √≠ndices en la carpeta ```/cbir_database```
- Genera el archivo de metadatos ```/cbir_database/image_data.csv```

### 4. Interfaz de Usuario Streamlit

Para interactuar visualmente con el motor de b√∫squeda y realizar consultas manuales:

```bash
streamlit run app.py
```
La aplicaci√≥n se abrir√° autom√°ticamente en ```http://localhost:8501```.

Funcionalidades:
- Selecci√≥n din√°mica de extractor
- Carga y recorte manual de la imagen de consulta
- Visualizaci√≥n de los resultados m√°s similares, im√°genes y etiquetas
- C√°lculo de Top-10 *Accuracy* en tiempo real (si se introduce la etiqueta).

### 5. Evaluaci√≥n automatizada (benchmarking)

**Nota: se han incluido los archivos resultantes de esta parte en la carpeta ```/result``` realizados con nuestro conjunto de consulta. Si desea evaluar el mismo, puede saltarse este paso.**

Para obtener las m√©tricas de rendimiento (Top-k *Accuracy* y Latencia) sobre todo el conjunto de test sin intervenci√≥n manual:

```bash
python evaluation.py
```

Este comando:
- Recorre la carpeta ```/test```
- Computa el Top-k *Accuracy* medio para $k=1$ y $k=10$ y latencia media para cada extractor, as√≠ como el Top-10 Accuracy medio para cada par famoso-extractor.
- Genera dos archivos ```.csv``` en la carpeta ```/proyecto``` con las m√©tricas detalladas

## üß† Extractores Implementados
| Modelo | Tipo | Descripci√≥n | Dimensi√≥n Vector |
| :--- | :--- | :--- | :--- |
| **Histograma de Color** | Estad√≠stico | Distribuci√≥n de color RGB. | 512 |
| **SIFT** | Descriptor Local | BoVW + K-Means. | 100 |
| **ResNet50** | CNN (Generalista) | Pre-entrenada con ImageNet. | 2048 |
| **VGG-Face** | CNN (Especialista) | *Fine-tuned* para reconocimiento facial. | 4096 |
| **DINOv2** | *Transformer* | Modelo autosupervisado (ViT) de Meta AI. | 768 |

## üìÇ Estructura del proyecto
```text
cbir_project/
‚îÇ
‚îú‚îÄ‚îÄ app.py
‚îú‚îÄ‚îÄ cbir.py
‚îú‚îÄ‚îÄ evaluation.py
‚îú‚îÄ‚îÄ requirements.txt
‚îÇ
‚îú‚îÄ‚îÄ cbir_database/
‚îÇ   ‚îú‚îÄ‚îÄ index_resnet.faiss
‚îÇ   ‚îú‚îÄ‚îÄ index_vggface.faiss
‚îÇ   ‚îú‚îÄ‚îÄ image_data.csv
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ images/ 
‚îú‚îÄ‚îÄ test/
‚îî‚îÄ‚îÄ result/
```

## üìù Notas importantes
- El c√≥digo se ha probado en dispositivos con RAM >= 16GB. Hay modelos que pueden aprovechar CUDA si est√° disponible, pero los resultados generados en el *benchmark* no ser√°n v√°lidos al no aplicarse a todos los modelos.
- No se recomienda editar manualmente los archivos ```.faiss```.
- Si se a√±aden nuevas im√°genes a la carpeta ```/images``` se deber√° de ejecutar de nuevo ```python cbir.py``` para considerar los nuevos √≠ndices en la galer√≠a.

---

**Autores**: Laura Mart√≠n y Miguel Gallego


**Fecha**: 12 Dec 2025

<div align="center">
    <img src="https://www.upm.es/gsfs/SFS11864" width="500" alt="Logo UPM">
</div>